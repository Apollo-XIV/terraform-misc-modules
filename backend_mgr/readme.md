# Backend Manager
This module acts as a unified solution for your backend.tf file, as well as handling different environments you might use. This module is opinionated, but more convenient than if it offered full freedom. If you want a more modular approach, look at these alternative component modules:
- s3_backend
- env_gen

## Example Usage
### .backend/main.tf
```hcl
variable "ENV" {}

module "backend" {
  source = "../."
  prefix = "backend-test"

  output_dir = "${path.root}/.."

  environment_configs_dir = "${path.root}/envs"
  environments = [
    "dev",
    "staging"
  ]
  ENV = var.ENV

  variables = {
    cidr = "string"
  }

  approved_arns = [
    data.aws_caller_identity.current.arn
  ]
}

data "aws_caller_identity" "current" {}
```
### envs/dev-environment.yaml
```yaml
cidr: 10.100.0.0/16
```

### TF_VAR_ENV = "dev"
```bash
export TF_VAR_ENV="dev"
```
this config handily generates the following backend.tf, as well as automatically creating both tfvar and variable requirement files, autofilling from environment specific files.
```hcl

        ##############################################
        ## THIS FILE IS AUTOGENERATED,  DO NOT EDIT ##
        ## -- EDIT BACKEND MODULE INPUTS INSTEAD -- ##
        ##############################################

terraform {
  required_version = ">=1.9.5"
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = ">=5.60.0"
    }
  }        
      
  backend "s3" {
    bucket = "backend-test-state-20240830151632434000000001"
    key    = "backend-test-dev.tfstate"
    region = "eu-west-1"

    dynamodb_table = "arn:aws:dynamodb:eu-west-1:013948180024:table/backend-test-dev-locktable"
    encrypt        = true
    assume_role = {
      role_arn = "arn:aws:iam::013948180024:role/backend-test-iac-role"
      session_name = "backend-test-iac"
    }
  }
}
```
